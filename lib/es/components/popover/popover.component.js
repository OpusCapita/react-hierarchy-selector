function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/* eslint-disable jsx-a11y/no-static-element-interactions */

/* eslint-disable jsx-a11y/no-noninteractive-tabindex */
import React from 'react';
import PropTypes from 'prop-types';
import SearchBar from '@opuscapita/react-searchbar';
import { dataSourceProviderType } from '../../services/types';
import Search from '../../models/search';
import GroupEntity from '../../models/group.entity';
import CommonLayout from './layouts/common.layout';
import SpinnerLayout from './layouts/spinner.layout';
import HSSelectButton from './select-btn.component';
import PopoverSearchContent from './search/search-content.component';
import EventHandler from './event-handlers';
import { CLASS_NAME_SEARCH_FOCUSABLE } from './constants';
import Utils from '../../utils';
import './popover.scss';

var HierarchySelectorPopover =
/*#__PURE__*/
function (_React$PureComponent) {
  _inheritsLoose(HierarchySelectorPopover, _React$PureComponent);

  function HierarchySelectorPopover(props) {
    var _this;

    _this = _React$PureComponent.call(this, props) || this;

    _defineProperty(_assertThisInitialized(_this), "onFocusOutHandler", function (e) {
      if (!Utils.isFocusOnCurrentTarget(e)) _this.props.onComponentBlur();
    });

    _defineProperty(_assertThisInitialized(_this), "onSearchChangeHandler", function (searchingFor) {
      return _this.setState({
        searchingFor: searchingFor
      });
    });

    _defineProperty(_assertThisInitialized(_this), "onSelectHandler", function (data, flags) {
      var model = null;

      if (data) {
        var groupName = data.name ? data.name : 'Undefined';
        var items = Array.isArray(data) ? data : [data];
        model = new GroupEntity(groupName, items);
      }

      _this.props.onSelect(model, flags);
    });

    _defineProperty(_assertThisInitialized(_this), "onKeyDownHanlder", function (e) {
      EventHandler.searchElementFocusHanlder(e);
    });

    _defineProperty(_assertThisInitialized(_this), "getSearchElement", function () {
      return React.createElement(SearchBar, {
        autoFocus: true,
        defaltValue: _this.state.searchingFor,
        inputClassName: CLASS_NAME_SEARCH_FOCUSABLE,
        isDynamic: true,
        isTooltipEnabled: !!_this.props.searchTooltip,
        minChars: 2,
        translations: {
          tooltip: _this.props.searchTooltip,
          searchPlaceHolder: _this.props.searchPlaceHolder
        },
        onSearch: _this.onSearchChangeHandler,
        onClear: _this.props.onShouldClosePopover
      });
    });

    _defineProperty(_assertThisInitialized(_this), "getLists", function () {
      return React.createElement("div", null, React.createElement(HSSelectButton, {
        label: _this.props.btnOpenViewLabel,
        onClick: _this.props.onShouldOpenView
      }));
    });

    _defineProperty(_assertThisInitialized(_this), "getSearchLayout", function () {
      var searchModel = new Search(_this.props.dataSourceProvider);
      var foundItems = searchModel.getFoundFromHierarchy(_this.state.searchingFor);
      return React.createElement(PopoverSearchContent, {
        foundItems: foundItems,
        onSelect: _this.onSelectHandler,
        itemRenderFunction: _this.props.foundItemRenderFunction
      });
    });

    _defineProperty(_assertThisInitialized(_this), "getMainLayout", function () {
      return React.createElement(CommonLayout, null, _this.getSearchElement(), _this.state.searchingFor !== '' ? _this.getSearchLayout() : _this.getLists());
    });

    _this.state = {
      isDataLoaded: props.dataSourceProvider.isLoaded,
      searchingFor: ''
    };
    return _this;
  }

  var _proto = HierarchySelectorPopover.prototype;

  _proto.componentWillMount = function componentWillMount() {
    var _this2 = this;

    if (!this.state.isDataLoaded) {
      this.props.dataSourceProvider.loadData().then(function () {
        _this2.setState({
          isDataLoaded: true
        });
      });
    }
  };

  _proto.componentDidMount = function componentDidMount() {
    this.mainElement.addEventListener('focusout', this.onFocusOutHandler);
  };

  _proto.componentWillUnmount = function componentWillUnmount() {
    this.mainElement.removeEventListener('focusout', this.onFocusOutHandler);
  };

  _proto.render = function render() {
    var _this3 = this;

    return React.createElement("div", {
      className: "oc-hierarchy-selector-popover",
      tabIndex: "0",
      ref: function ref(el) {
        _this3.mainElement = el;
      }
    }, this.state.isDataLoaded ? this.getMainLayout() : React.createElement(SpinnerLayout, null));
  };

  return HierarchySelectorPopover;
}(React.PureComponent);

export { HierarchySelectorPopover as default };
HierarchySelectorPopover.defaultProps = {
  onComponentBlur: function onComponentBlur() {},
  onSelect: function onSelect() {},
  onShouldOpenView: function onShouldOpenView() {},
  onShouldClosePopover: function onShouldClosePopover() {},
  foundItemRenderFunction: null,
  btnOpenViewLabel: 'Select...',
  searchPlaceHolder: 'Search...',
  searchTooltip: null
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3BvcG92ZXIvcG9wb3Zlci5jb21wb25lbnQuanN4Il0sIm5hbWVzIjpbIlJlYWN0IiwiUHJvcFR5cGVzIiwiU2VhcmNoQmFyIiwiZGF0YVNvdXJjZVByb3ZpZGVyVHlwZSIsIlNlYXJjaCIsIkdyb3VwRW50aXR5IiwiQ29tbW9uTGF5b3V0IiwiU3Bpbm5lckxheW91dCIsIkhTU2VsZWN0QnV0dG9uIiwiUG9wb3ZlclNlYXJjaENvbnRlbnQiLCJFdmVudEhhbmRsZXIiLCJDTEFTU19OQU1FX1NFQVJDSF9GT0NVU0FCTEUiLCJVdGlscyIsIkhpZXJhcmNoeVNlbGVjdG9yUG9wb3ZlciIsInByb3BzIiwiZSIsImlzRm9jdXNPbkN1cnJlbnRUYXJnZXQiLCJvbkNvbXBvbmVudEJsdXIiLCJzZWFyY2hpbmdGb3IiLCJzZXRTdGF0ZSIsImRhdGEiLCJmbGFncyIsIm1vZGVsIiwiZ3JvdXBOYW1lIiwibmFtZSIsIml0ZW1zIiwiQXJyYXkiLCJpc0FycmF5Iiwib25TZWxlY3QiLCJzZWFyY2hFbGVtZW50Rm9jdXNIYW5sZGVyIiwic3RhdGUiLCJzZWFyY2hUb29sdGlwIiwidG9vbHRpcCIsInNlYXJjaFBsYWNlSG9sZGVyIiwib25TZWFyY2hDaGFuZ2VIYW5kbGVyIiwib25TaG91bGRDbG9zZVBvcG92ZXIiLCJidG5PcGVuVmlld0xhYmVsIiwib25TaG91bGRPcGVuVmlldyIsInNlYXJjaE1vZGVsIiwiZGF0YVNvdXJjZVByb3ZpZGVyIiwiZm91bmRJdGVtcyIsImdldEZvdW5kRnJvbUhpZXJhcmNoeSIsIm9uU2VsZWN0SGFuZGxlciIsImZvdW5kSXRlbVJlbmRlckZ1bmN0aW9uIiwiZ2V0U2VhcmNoRWxlbWVudCIsImdldFNlYXJjaExheW91dCIsImdldExpc3RzIiwiaXNEYXRhTG9hZGVkIiwiaXNMb2FkZWQiLCJjb21wb25lbnRXaWxsTW91bnQiLCJsb2FkRGF0YSIsInRoZW4iLCJjb21wb25lbnREaWRNb3VudCIsIm1haW5FbGVtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uRm9jdXNPdXRIYW5kbGVyIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwicmVuZGVyIiwiZWwiLCJnZXRNYWluTGF5b3V0IiwiUHVyZUNvbXBvbmVudCIsImRlZmF1bHRQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7O0FBQ0E7QUFFQSxPQUFPQSxLQUFQLE1BQWtCLE9BQWxCO0FBQ0EsT0FBT0MsU0FBUCxNQUFzQixZQUF0QjtBQUNBLE9BQU9DLFNBQVAsTUFBc0IsNkJBQXRCO0FBRUEsU0FBU0Msc0JBQVQsUUFBdUMsc0JBQXZDO0FBQ0EsT0FBT0MsTUFBUCxNQUFtQixxQkFBbkI7QUFDQSxPQUFPQyxXQUFQLE1BQXdCLDJCQUF4QjtBQUVBLE9BQU9DLFlBQVAsTUFBeUIseUJBQXpCO0FBQ0EsT0FBT0MsYUFBUCxNQUEwQiwwQkFBMUI7QUFDQSxPQUFPQyxjQUFQLE1BQTJCLHdCQUEzQjtBQUNBLE9BQU9DLG9CQUFQLE1BQWlDLG1DQUFqQztBQUNBLE9BQU9DLFlBQVAsTUFBeUIsa0JBQXpCO0FBQ0EsU0FBU0MsMkJBQVQsUUFBNEMsYUFBNUM7QUFDQSxPQUFPQyxLQUFQLE1BQWtCLGFBQWxCO0FBQ0EsT0FBTyxnQkFBUDs7SUFFcUJDLHdCOzs7OztBQUNuQixvQ0FBWUMsS0FBWixFQUFtQjtBQUFBOztBQUNqQiw0Q0FBTUEsS0FBTjs7QUFEaUIsd0VBd0JDLFVBQUNDLENBQUQsRUFBTztBQUN6QixVQUFJLENBQUNILEtBQUssQ0FBQ0ksc0JBQU4sQ0FBNkJELENBQTdCLENBQUwsRUFBc0MsTUFBS0QsS0FBTCxDQUFXRyxlQUFYO0FBQ3ZDLEtBMUJrQjs7QUFBQSw0RUE0QkssVUFBQUMsWUFBWTtBQUFBLGFBQUksTUFBS0MsUUFBTCxDQUFjO0FBQUVELFFBQUFBLFlBQVksRUFBWkE7QUFBRixPQUFkLENBQUo7QUFBQSxLQTVCakI7O0FBQUEsc0VBOEJELFVBQUNFLElBQUQsRUFBT0MsS0FB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IGpzeC1hMTF5L25vLXN0YXRpYy1lbGVtZW50LWludGVyYWN0aW9ucyAqL1xuLyogZXNsaW50LWRpc2FibGUganN4LWExMXkvbm8tbm9uaW50ZXJhY3RpdmUtdGFiaW5kZXggKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgU2VhcmNoQmFyIGZyb20gJ0BvcHVzY2FwaXRhL3JlYWN0LXNlYXJjaGJhcic7XG5cbmltcG9ydCB7IGRhdGFTb3VyY2VQcm92aWRlclR5cGUgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy90eXBlcyc7XG5pbXBvcnQgU2VhcmNoIGZyb20gJy4uLy4uL21vZGVscy9zZWFyY2gnO1xuaW1wb3J0IEdyb3VwRW50aXR5IGZyb20gJy4uLy4uL21vZGVscy9ncm91cC5lbnRpdHknO1xuXG5pbXBvcnQgQ29tbW9uTGF5b3V0IGZyb20gJy4vbGF5b3V0cy9jb21tb24ubGF5b3V0JztcbmltcG9ydCBTcGlubmVyTGF5b3V0IGZyb20gJy4vbGF5b3V0cy9zcGlubmVyLmxheW91dCc7XG5pbXBvcnQgSFNTZWxlY3RCdXR0b24gZnJvbSAnLi9zZWxlY3QtYnRuLmNvbXBvbmVudCc7XG5pbXBvcnQgUG9wb3ZlclNlYXJjaENvbnRlbnQgZnJvbSAnLi9zZWFyY2gvc2VhcmNoLWNvbnRlbnQuY29tcG9uZW50JztcbmltcG9ydCBFdmVudEhhbmRsZXIgZnJvbSAnLi9ldmVudC1oYW5kbGVycyc7XG5pbXBvcnQgeyBDTEFTU19OQU1FX1NFQVJDSF9GT0NVU0FCTEUgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgVXRpbHMgZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0ICcuL3BvcG92ZXIuc2Nzcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEhpZXJhcmNoeVNlbGVjdG9yUG9wb3ZlciBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgaXNEYXRhTG9hZGVkOiBwcm9wcy5kYXRhU291cmNlUHJvdmlkZXIuaXNMb2FkZWQsXG4gICAgICBzZWFyY2hpbmdGb3I6ICcnLFxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnRXaWxsTW91bnQoKSB7XG4gICAgaWYgKCF0aGlzLnN0YXRlLmlzRGF0YUxvYWRlZCkge1xuICAgICAgdGhpcy5wcm9wcy5kYXRhU291cmNlUHJvdmlkZXIubG9hZERhdGEoKS50aGVuKCgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlzRGF0YUxvYWRlZDogdHJ1ZSB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMubWFpbkVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNvdXQnLCB0aGlzLm9uRm9jdXNPdXRIYW5kbGVyKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHRoaXMubWFpbkVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXNvdXQnLCB0aGlzLm9uRm9jdXNPdXRIYW5kbGVyKTtcbiAgfVxuXG4gIG9uRm9jdXNPdXRIYW5kbGVyID0gKGUpID0+IHtcbiAgICBpZiAoIVV0aWxzLmlzRm9jdXNPbkN1cnJlbnRUYXJnZXQoZSkpIHRoaXMucHJvcHMub25Db21wb25lbnRCbHVyKCk7XG4gIH1cblxuICBvblNlYXJjaENoYW5nZUhhbmRsZXIgPSBzZWFyY2hpbmdGb3IgPT4gdGhpcy5zZXRTdGF0ZSh7IHNlYXJjaGluZ0ZvciB9KTtcblxuICBvblNlbGVjdEhhbmRsZXIgPSAoZGF0YSwgZmxhZ3MpID0+IHtcbiAgICBsZXQgbW9kZWwgPSBudWxsO1xuXG4gICAgaWYgKGRhdGEpIHtcbiAgICAgIGNvbnN0IGdyb3VwTmFtZSA9IGRhdGEubmFtZSA/IGRhdGEubmFtZSA6ICdVbmRlZmluZWQnO1xuICAgICAgY29uc3QgaXRlbXMgPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YSA6IFtkYXRhXTtcbiAgICAgIG1vZGVsID0gbmV3IEdyb3VwRW50aXR5KGdyb3VwTmFtZSwgaXRlbXMpO1xuICAgIH1cbiAgICB0aGlzLnByb3BzLm9uU2VsZWN0KG1vZGVsLCBmbGFncyk7XG4gIH1cblxuICBvbktleURvd25IYW5sZGVyID0gKGUpID0+IHtcbiAgICBFdmVudEhhbmRsZXIuc2VhcmNoRWxlbWVudEZvY3VzSGFubGRlcihlKTtcbiAgfVxuXG4gIGdldFNlYXJjaEVsZW1lbnQgPSAoKSA9PiAoXG4gICAgPFNlYXJjaEJhclxuICAgICAgYXV0b0ZvY3VzXG4gICAgICBkZWZhbHRWYWx1ZT17dGhpcy5zdGF0ZS5zZWFyY2hpbmdGb3J9XG4gICAgICBpbnB1dENsYXNzTmFtZT17Q0xBU1NfTkFNRV9TRUFSQ0hfRk9DVVNBQkxFfVxuICAgICAgaXNEeW5hbWljXG4gICAgICBpc1Rvb2x0aXBFbmFibGVkPXshIXRoaXMucHJvcHMuc2VhcmNoVG9vbHRpcH1cbiAgICAgIG1pbkNoYXJzPXsyfVxuICAgICAgdHJhbnNsYXRpb25zPXt7XG4gICAgICAgIHRvb2x0aXA6IHRoaXMucHJvcHMuc2VhcmNoVG9vbHRpcCxcbiAgICAgICAgc2VhcmNoUGxhY2VIb2xkZXI6IHRoaXMucHJvcHMuc2VhcmNoUGxhY2VIb2xkZXIsXG4gICAgICB9fVxuICAgICAgb25TZWFyY2g9e3RoaXMub25TZWFyY2hDaGFuZ2VIYW5kbGVyfVxuICAgICAgb25DbGVhcj17dGhpcy5wcm9wcy5vblNob3VsZENsb3NlUG9wb3Zlcn1cbiAgICAvPlxuICApO1xuXG4gIGdldExpc3RzID0gKCkgPT4gKFxuICAgIDxkaXY+XG4gICAgICA8SFNTZWxlY3RCdXR0b24gbGFiZWw9e3RoaXMucHJvcHMuYnRuT3BlblZpZXdMYWJlbH0gb25DbGljaz17dGhpcy5wcm9wcy5vblNob3VsZE9wZW5WaWV3fSAvPlxuICAgIDwvZGl2PlxuICApO1xuXG4gIGdldFNlYXJjaExheW91dCA9ICgpID0+IHtcbiAgICBjb25zdCBzZWFyY2hNb2RlbCA9IG5ldyBTZWFyY2godGhpcy5wcm9wcy5kYXRhU291cmNlUHJvdmlkZXIpO1xuICAgIGNvbnN0IGZvdW5kSXRlbXMgPSBzZWFyY2hNb2RlbC5nZXRGb3VuZEZyb21IaWVyYXJjaHkodGhpcy5zdGF0ZS5zZWFyY2hpbmdGb3IpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxQb3BvdmVyU2VhcmNoQ29udGVudFxuICAgICAgICBmb3VuZEl0ZW1zPXtmb3VuZEl0ZW1zfVxuICAgICAgICBvblNlbGVjdD17dGhpcy5vblNlbGVjdEhhbmRsZXJ9XG4gICAgICAgIGl0ZW1SZW5kZXJGdW5jdGlvbj17dGhpcy5wcm9wcy5mb3VuZEl0ZW1SZW5kZXJGdW5jdGlvbn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIGdldE1haW5MYXlvdXQgPSAoKSA9PiAoXG4gICAgPENvbW1vbkxheW91dD5cbiAgICAgIHt0aGlzLmdldFNlYXJjaEVsZW1lbnQoKX1cbiAgICAgIHt0aGlzLnN0YXRlLnNlYXJjaGluZ0ZvciAhPT0gJycgPyB0aGlzLmdldFNlYXJjaExheW91dCgpIDogdGhpcy5nZXRMaXN0cygpfVxuICAgIDwvQ29tbW9uTGF5b3V0PlxuICApO1xuXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBjbGFzc05hbWU9XCJvYy1oaWVyYXJjaHktc2VsZWN0b3ItcG9wb3ZlclwiXG4gICAgICAgIHRhYkluZGV4PVwiMFwiXG4gICAgICAgIHJlZj17KGVsKSA9PiB7IHRoaXMubWFpbkVsZW1lbnQgPSBlbDsgfX1cbiAgICAgID5cbiAgICAgICAgeyB0aGlzLnN0YXRlLmlzRGF0YUxvYWRlZCA/IHRoaXMuZ2V0TWFpbkxheW91dCgpIDogPFNwaW5uZXJMYXlvdXQgLz4gfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5IaWVyYXJjaHlTZWxlY3RvclBvcG92ZXIucHJvcFR5cGVzID0ge1xuICBkYXRhU291cmNlUHJvdmlkZXI6IGRhdGFTb3VyY2VQcm92aWRlclR5cGUuaXNSZXF1aXJlZCxcbiAgb25Db21wb25lbnRCbHVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25TZWxlY3Q6IFByb3BUeXBlcy5mdW5jLFxuICBvblNob3VsZE9wZW5WaWV3OiBQcm9wVHlwZXMuZnVuYyxcbiAgZm91bmRJdGVtUmVuZGVyRnVuY3Rpb246IFByb3BUeXBlcy5mdW5jLFxuICBvblNob3VsZENsb3NlUG9wb3ZlcjogUHJvcFR5cGVzLmZ1bmMsXG4gIGJ0bk9wZW5WaWV3TGFiZWw6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5zdHJpbmcsIFByb3BUeXBlcy5lbGVtZW50XSksXG4gIHNlYXJjaFBsYWNlSG9sZGVyOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBzZWFyY2hUb29sdGlwOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuZWxlbWVudCwgUHJvcFR5cGVzLnN0cmluZ10pLFxufTtcblxuSGllcmFyY2h5U2VsZWN0b3JQb3BvdmVyLmRlZmF1bHRQcm9wcyA9IHtcbiAgb25Db21wb25lbnRCbHVyOiAoKSA9PiB7fSxcbiAgb25TZWxlY3Q6ICgpID0+IHt9LFxuICBvblNob3VsZE9wZW5WaWV3OiAoKSA9PiB7fSxcbiAgb25TaG91bGRDbG9zZVBvcG92ZXI6ICgpID0+IHt9LFxuICBmb3VuZEl0ZW1SZW5kZXJGdW5jdGlvbjogbnVsbCxcbiAgYnRuT3BlblZpZXdMYWJlbDogJ1NlbGVjdC4uLicsXG4gIHNlYXJjaFBsYWNlSG9sZGVyOiAnU2VhcmNoLi4uJyxcbiAgc2VhcmNoVG9vbHRpcDogbnVsbCxcbn07XG4iXX0=