"use strict";

exports.__esModule = true;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/* eslint-disable array-callback-return */

var parents = new WeakMap();
var checkedAll = new WeakMap();
var checkedItemsBackUp = new WeakMap();
var checkedItems = new WeakMap();

function addChildren(that, item) {
  if (item) {
    if (item.children && Array.isArray(item.children) && item.children.length > 0) {
      item.children.forEach(function (child) {
        addChildren(that, child);
      });
    } else {
      that.addCheckedItem(item);
    }
  }
}

var CheckedHashItem = function () {
  function CheckedHashItem() {
    var prnts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

    _classCallCheck(this, CheckedHashItem);

    this.timestamp = Date.now();
    parents.set(this, prnts.slice());
    checkedAll.set(this, false);
    checkedItems.set(this, []);
    checkedItemsBackUp.set(this, []);
  }

  CheckedHashItem.prototype.getParents = function getParents() {
    return parents.get(this).slice();
  };

  CheckedHashItem.prototype.getCheckedItems = function getCheckedItems() {
    return checkedItems.get(this).slice();
  };

  CheckedHashItem.prototype.checkAll = function checkAll() {
    var prnts = parents.get(this);
    checkedAll.set(this, true);
    this.clearChecked();
    var initialParent = prnts.length > 0 ? prnts[prnts.length - 1] : undefined;

    if (initialParent) addChildren(this, initialParent);
  };

  CheckedHashItem.prototype.uncheckAll = function uncheckAll() {
    checkedAll.set(this, false);
    this.clearChecked();
  };

  CheckedHashItem.prototype.isCheckedAll = function isCheckedAll() {
    return checkedAll.get(this);
  };

  CheckedHashItem.prototype.clearChecked = function clearChecked() {
    checkedItems.get(this).splice(0);
  };

  CheckedHashItem.prototype.addCheckedItem = function addCheckedItem(item) {
    checkedItems.get(this).push(item);
  };

  CheckedHashItem.prototype.removeCheckedItem = function removeCheckedItem(item) {
    var items = checkedItems.get(this);
    items.reduceRight(function (acc, currentItem, index, currentItems) {
      if (currentItem.id === item.id) {
        currentItems.splice(index, 1);
      }
    }, []);
  };

  CheckedHashItem.prototype.createCopy = function createCopy() {
    var copy = new CheckedHashItem();

    parents.set(copy, [].concat(parents.get(this)));
    checkedAll.set(copy, checkedAll.get(this));
    checkedItems.set(copy, [].concat(checkedItems.get(this)));
    checkedItemsBackUp.set(copy, [].concat(checkedItemsBackUp.get(this)));

    return copy;
  };

  CheckedHashItem.prototype.makeBackUp = function makeBackUp() {
    checkedItemsBackUp.set(this, [].concat(checkedItems.get(this)));
  };

  CheckedHashItem.prototype.restoreFromBackUp = function restoreFromBackUp() {
    checkedItems.set(this, [].concat(checkedItemsBackUp.get(this)));
  };

  return CheckedHashItem;
}();

exports.default = CheckedHashItem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9tb2RlbHMvY2hlY2tlZC1pdGVtcy9jaGVja2VkLWhhc2gtaXRlbS5qcyJdLCJuYW1lcyI6WyJwYXJlbnRzIiwiV2Vha01hcCIsImNoZWNrZWRBbGwiLCJjaGVja2VkSXRlbXNCYWNrVXAiLCJjaGVja2VkSXRlbXMiLCJhZGRDaGlsZHJlbiIsInRoYXQiLCJpdGVtIiwiY2hpbGRyZW4iLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJmb3JFYWNoIiwiY2hpbGQiLCJhZGRDaGVja2VkSXRlbSIsIkNoZWNrZWRIYXNoSXRlbSIsInBybnRzIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsInNldCIsInNsaWNlIiwiZ2V0UGFyZW50cyIsImdldCIsImdldENoZWNrZWRJdGVtcyIsImNoZWNrQWxsIiwiY2xlYXJDaGVja2VkIiwiaW5pdGlhbFBhcmVudCIsInVuZGVmaW5lZCIsInVuY2hlY2tBbGwiLCJpc0NoZWNrZWRBbGwiLCJzcGxpY2UiLCJwdXNoIiwicmVtb3ZlQ2hlY2tlZEl0ZW0iLCJpdGVtcyIsInJlZHVjZVJpZ2h0IiwiYWNjIiwiY3VycmVudEl0ZW0iLCJpbmRleCIsImN1cnJlbnRJdGVtcyIsImlkIiwiY3JlYXRlQ29weSIsImNvcHkiLCJtYWtlQmFja1VwIiwicmVzdG9yZUZyb21CYWNrVXAiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOztBQUVBLElBQU1BLFVBQVUsSUFBSUMsT0FBSixFQUFoQjtBQUNBLElBQU1DLGFBQWEsSUFBSUQsT0FBSixFQUFuQjtBQUNBLElBQU1FLHFCQUFxQixJQUFJRixPQUFKLEVBQTNCO0FBQ0EsSUFBTUcsZUFBZSxJQUFJSCxPQUFKLEVBQXJCOztBQUVBLFNBQVNJLFdBQVQsQ0FBcUJDLElBQXJCLEVBQTJCQyxJQUEzQixFQUFpQztBQUMvQixNQUFJQSxJQUFKLEVBQVU7QUFDUixRQUFJQSxLQUFLQyxRQUFMLElBQWlCQyxNQUFNQyxPQUFOLENBQWNILEtBQUtDLFFBQW5CLENBQWpC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aUN2QyxtQkFBbUJvQixHQUFuQixDQUF1QixJQUF2QixDQUFqQzs7QUFFQSxXQUFPbUIsSUFBUDtBQUNELEc7OzRCQUVEQyxVLHlCQUFhO0FBQ1h4Qyx1QkFBbUJpQixHQUFuQixDQUF1QixJQUF2QixZQUFpQ2hCLGFBQWFtQixHQUFiLENBQWlCLElBQWpCLENBQWpDO0FBQ0QsRzs7NEJBRURxQixpQixnQ0FBb0I7QUFDbEJ4QyxpQkFBYWdCLEdBQWIsQ0FBaUIsSUFBakIsWUFBMkJqQixtQkFBbUJvQixHQUFuQixDQUF1QixJQUF2QixDQUEzQjtBQUNELEc7Ozs7O2tCQXJFa0JSLGUiLCJmaWxlIjoiY2hlY2tlZC1oYXNoLWl0ZW0uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBhcnJheS1jYWxsYmFjay1yZXR1cm4gKi9cclxuXHJcbmNvbnN0IHBhcmVudHMgPSBuZXcgV2Vha01hcCgpO1xyXG5jb25zdCBjaGVja2VkQWxsID0gbmV3IFdlYWtNYXAoKTtcclxuY29uc3QgY2hlY2tlZEl0ZW1zQmFja1VwID0gbmV3IFdlYWtNYXAoKTtcclxuY29uc3QgY2hlY2tlZEl0ZW1zID0gbmV3IFdlYWtNYXAoKTtcclxuXHJcbmZ1bmN0aW9uIGFkZENoaWxkcmVuKHRoYXQsIGl0ZW0pIHtcclxuICBpZiAoaXRlbSkge1xyXG4gICAgaWYgKGl0ZW0uY2hpbGRyZW4gJiYgQXJyYXkuaXNBcnJheShpdGVtLmNoaWxkcmVuKSAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgaXRlbS5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZCkgPT4geyBhZGRDaGlsZHJlbih0aGF0LCBjaGlsZCk7IH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhhdC5hZGRDaGVja2VkSXRlbShpdGVtKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENoZWNrZWRIYXNoSXRlbSB7XHJcbiAgY29uc3RydWN0b3IocHJudHMgPSBbXSkge1xyXG4gICAgdGhpcy50aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xyXG4gICAgcGFyZW50cy5zZXQodGhpcywgcHJudHMuc2xpY2UoKSk7XHJcbiAgICBjaGVja2VkQWxsLnNldCh0aGlzLCBmYWxzZSk7XHJcbiAgICBjaGVja2VkSXRlbXMuc2V0KHRoaXMsIFtdKTtcclxuICAgIGNoZWNrZWRJdGVtc0JhY2tVcC5zZXQodGhpcywgW10pO1xyXG4gIH1cclxuXHJcbiAgZ2V0UGFyZW50cygpIHtcclxuICAgIHJldHVybiBwYXJlbnRzLmdldCh0aGlzKS5zbGljZSgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q2hlY2tlZEl0ZW1zKCkge1xyXG4gICAgcmV0dXJuIGNoZWNrZWRJdGVtcy5nZXQodGhpcykuc2xpY2UoKTtcclxuICB9XHJcblxyXG4gIGNoZWNrQWxsKCkge1xyXG4gICAgY29uc3QgcHJudHMgPSBwYXJlbnRzLmdldCh0aGlzKTtcclxuICAgIGNoZWNrZWRBbGwuc2V0KHRoaXMsIHRydWUpO1xyXG4gICAgdGhpcy5jbGVhckNoZWNrZWQoKTtcclxuICAgIGNvbnN0IGluaXRpYWxQYXJlbnQgPSBwcm50cy5sZW5ndGggPiAwID8gcHJudHNbcHJudHMubGVuZ3RoIC0gMV0gOiB1bmRlZmluZWQ7XHJcblxyXG4gICAgaWYgKGluaXRpYWxQYXJlbnQpIGFkZENoaWxkcmVuKHRoaXMsIGluaXRpYWxQYXJlbnQpO1xyXG4gIH1cclxuXHJcbiAgdW5jaGVja0FsbCgpIHtcclxuICAgIGNoZWNrZWRBbGwuc2V0KHRoaXMsIGZhbHNlKTtcclxuICAgIHRoaXMuY2xlYXJDaGVja2VkKCk7XHJcbiAgfVxyXG5cclxuICBpc0NoZWNrZWRBbGwoKSB7XHJcbiAgICByZXR1cm4gY2hlY2tlZEFsbC5nZXQodGhpcyk7XHJcbiAgfVxyXG5cclxuICBjbGVhckNoZWNrZWQoKSB7XHJcbiAgICBjaGVja2VkSXRlbXMuZ2V0KHRoaXMpLnNwbGljZSgwKTtcclxuICB9XHJcblxyXG4gIGFkZENoZWNrZWRJdGVtKGl0ZW0pIHtcclxuICAgIGNoZWNrZWRJdGVtcy5nZXQodGhpcykucHVzaChpdGVtKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUNoZWNrZWRJdGVtKGl0ZW0pIHtcclxuICAgIGNvbnN0IGl0ZW1zID0gY2hlY2tlZEl0ZW1zLmdldCh0aGlzKTtcclxuICAgIGl0ZW1zLnJlZHVjZVJpZ2h0KChhY2MsIGN1cnJlbnRJdGVtLCBpbmRleCwgY3VycmVudEl0ZW1zKSA9PiB7XHJcbiAgICAgIGlmIChjdXJyZW50SXRlbS5pZCA9PT0gaXRlbS5pZCkge1xyXG4gICAgICAgIGN1cnJlbnRJdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICB9XHJcbiAgICB9LCBbXSk7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVDb3B5KCkge1xyXG4gICAgY29uc3QgY29weSA9IG5ldyBDaGVja2VkSGFzaEl0ZW0oKTtcclxuXHJcbiAgICBwYXJlbnRzLnNldChjb3B5LCBbLi4ucGFyZW50cy5nZXQodGhpcyldKTtcclxuICAgIGNoZWNrZWRBbGwuc2V0KGNvcHksIGNoZWNrZWRBbGwuZ2V0KHRoaXMpKTtcclxuICAgIGNoZWNrZWRJdGVtcy5zZXQoY29weSwgWy4uLmNoZWNrZWRJdGVtcy5nZXQodGhpcyldKTtcclxuICAgIGNoZWNrZWRJdGVtc0JhY2tVcC5zZXQoY29weSwgWy4uLmNoZWNrZWRJdGVtc0JhY2tVcC5nZXQodGhpcyldKTtcclxuXHJcbiAgICByZXR1cm4gY29weTtcclxuICB9XHJcblxyXG4gIG1ha2VCYWNrVXAoKSB7XHJcbiAgICBjaGVja2VkSXRlbXNCYWNrVXAuc2V0KHRoaXMsIFsuLi5jaGVja2VkSXRlbXMuZ2V0KHRoaXMpXSk7XHJcbiAgfVxyXG5cclxuICByZXN0b3JlRnJvbUJhY2tVcCgpIHtcclxuICAgIGNoZWNrZWRJdGVtcy5zZXQodGhpcywgWy4uLmNoZWNrZWRJdGVtc0JhY2tVcC5nZXQodGhpcyldKTtcclxuICB9XHJcbn1cclxuIl19